# Generated by Gareth Owen <gaz@athene.co.uk>

root=/home/salman/DPP/dpp-llvm/build
sysroot=/home/salman/DPP/sysroot-glibc

CC=wllvm
#CC=wllvm --target=aarch64-linux-gnu -march=armv8.3-a --sysroot=/home/salman/DPP/sysroot-glibc --gcc-toolchain=/home/salman/DPP/linarogcc
CFLAGS= -v -g -O2 -D_FORTIFY_SOURCE=0 -fno-stack-protector 
LDFLAGS = 
LIBS= 
DESTDIR="/usr/local/ghttpd"

OBJ = main.o protocol.o util.o

default: ghttpd

ghttpd: $(OBJ)
	$(CC) $(LDFLAGS) -o $@ $(OBJ) $(LIBS) 


install: ghttpd
	execstack -s ./ghttpd
	mkdir -p $(DESTDIR)
	mkdir -p $(DESTDIR)/cgi-bin
	mkdir -p $(DESTDIR)/htdocs
	cp -f ghttpd $(DESTDIR)/
	cp -f 404.html $(DESTDIR)/
	cp -f cgierror.html $(DESTDIR)/
	cp -f cmderror.html $(DESTDIR)/
	cp -f ghttpd.conf /etc/
	cp -f index.html $(DESTDIR)/htdocs/
	chown -R nobody.nogroup $(DESTDIR)
	chown -R nobody.nogroup $(DESTDIR)/*
	chown -R nobody.nogroup $(DESTDIR)/htdocs/*

clean:
	rm -f *.o ghttpd
	rm -rf $(DESTDIR)
	rm /etc/ghttpd.conf

